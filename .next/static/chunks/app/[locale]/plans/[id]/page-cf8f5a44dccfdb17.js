(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[176],{2994:(e,a,s)=>{Promise.resolve().then(s.bind(s,4559))},6046:(e,a,s)=>{"use strict";s.r(a);var r=s(6658),t={};for(let e in r)"default"!==e&&(t[e]=()=>r[e]);s.d(a,t)},4559:(e,a,s)=>{"use strict";s.r(a),s.d(a,{default:()=>o});var r=s(5155),t=s(2115),n=s(6046),l=s(8173),i=s.n(l);async function o(e){let{params:a}=e,s=(0,n.useRouter)(),l="new"===(await a).id,o=l?null:Number.parseInt((await a).id),[d,c]=(0,t.useState)(!l),[u,h]=(0,t.useState)(!1),[g,m]=(0,t.useState)("en"),[p,x]=(0,t.useState)(null),[f,b]=(0,t.useState)({show:!1}),[y,j]=(0,t.useState)({price:0,isBestValue:!1,translations:[{language:"en",duration:"",features:[]},{language:"fr",duration:"",features:[]},{language:"de",duration:"",features:[]},{language:"es",duration:"",features:[]},{language:"ar",duration:"",features:[]}]});(0,t.useEffect)(()=>{l||w()},[l]),(0,t.useEffect)(()=>{if(p){let e=setTimeout(()=>{x(null)},3e3);return()=>clearTimeout(e)}},[p]);let w=async()=>{try{c(!0);let e=await fetch("/api/getAllPlans");if(!e.ok)throw Error("Failed to fetch plans");let a=(await e.json()).find(e=>e.id===o);if(!a){x({show:!0,title:"Error",message:"Plan not found",type:"error"}),s.push("/plans");return}let r={id:a.id,price:a.price,isBestValue:a.isBestValue,translations:[]},t={};["en","fr","de","es","ar"].forEach(e=>{t[e]={language:e,duration:"",features:[]}}),a.PlanTranslations.forEach(e=>{t[e.language]={id:e.id,planId:e.planId,language:e.language,duration:e.duration,features:"string"==typeof e.features?JSON.parse(e.features):e.features}}),r.translations=Object.values(t),j(r)}catch(e){console.error("Error fetching plan:",e),x({show:!0,title:"Error",message:"Failed to load plan details. Please try again.",type:"error"})}finally{c(!1)}},v=(e,a,s)=>{j(r=>{let t=r.translations.map(r=>r.language===e?{...r,[a]:s}:r);return{...r,translations:t}})},N=(e,a)=>{v(e,"features",a.split("\n").filter(e=>""!==e.trim()))},k=async()=>{try{if(h(!0),y.price<=0){x({show:!0,title:"Validation Error",message:"Price must be greater than 0",type:"error"}),h(!1);return}let e=y.translations.find(e=>"en"===e.language);if(!e||!e.duration||0===e.features.length){x({show:!0,title:"Validation Error",message:"English translation is required with duration and at least one feature",type:"error"}),h(!1);return}let a={price:y.price,isBestValue:y.isBestValue,translations:{}};if(y.translations.forEach(e=>{(e.duration||e.features.length>0)&&(a.translations[e.language]={duration:e.duration,features:e.features})}),!(l?await fetch("/api/CreatePlan",{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify(a)}):await fetch("/api/updatePlan/".concat(o),{method:"PUT",headers:{"Content-Type":"application/json"},body:JSON.stringify({price:y.price,isBestValue:y.isBestValue,translations:y.translations})})).ok)throw Error(l?"Failed to create plan":"Failed to update plan");x({show:!0,title:"Success",message:l?"Plan created successfully":"Plan updated successfully",type:"success"}),s.push("/plans")}catch(e){console.error("Error saving plan:",e),x({show:!0,title:"Error",message:l?"Failed to create plan":"Failed to update plan",type:"error"})}finally{h(!1)}},E=async()=>{if(!l)try{if(h(!0),!(await fetch("/api/deletePlan/".concat(o),{method:"DELETE"})).ok)throw Error("Failed to delete plan");x({show:!0,title:"Success",message:"Plan deleted successfully",type:"success"}),s.push("/plans")}catch(e){console.error("Error deleting plan:",e),x({show:!0,title:"Error",message:"Failed to delete plan. Please try again.",type:"error"})}finally{h(!1),b({show:!1})}};return d?(0,r.jsx)("div",{className:"container mx-auto py-10 px-4 flex items-center justify-center min-h-[50vh]",children:(0,r.jsxs)("div",{className:"flex flex-col items-center gap-2",children:[(0,r.jsx)("div",{className:"h-8 w-8 border-4 border-blue-500 border-t-transparent rounded-full animate-spin"}),(0,r.jsx)("p",{children:"Loading plan details..."})]})}):(0,r.jsxs)("div",{className:"container mx-auto py-10 px-4",children:[p&&p.show&&(0,r.jsx)("div",{className:"fixed top-4 right-4 z-50 p-4 rounded-md shadow-md max-w-md ".concat("success"===p.type?"bg-green-100 border border-green-200":"bg-red-100 border border-red-200"),children:(0,r.jsxs)("div",{className:"flex justify-between items-start",children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("h3",{className:"font-medium ".concat("success"===p.type?"text-green-800":"text-red-800"),children:p.title}),(0,r.jsx)("p",{className:"text-sm ".concat("success"===p.type?"text-green-700":"text-red-700"),children:p.message})]}),(0,r.jsx)("button",{onClick:()=>x(null),className:"ml-4 ".concat("success"===p.type?"text-green-600":"text-red-600"," hover:opacity-75"),children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-5 w-5",viewBox:"0 0 20 20",fill:"currentColor",children:(0,r.jsx)("path",{fillRule:"evenodd",d:"M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z",clipRule:"evenodd"})})})]})}),f.show&&(0,r.jsx)("div",{className:"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-4",children:(0,r.jsxs)("div",{className:"bg-white rounded-lg max-w-md w-full p-6",children:[(0,r.jsx)("h3",{className:"text-lg font-medium mb-2",children:"Are you absolutely sure?"}),(0,r.jsx)("p",{className:"text-gray-500 mb-4",children:"This action cannot be undone. This will permanently delete the plan and all its translations."}),(0,r.jsxs)("div",{className:"flex justify-end gap-2",children:[(0,r.jsx)("button",{onClick:()=>b({show:!1}),className:"px-4 py-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:"Cancel"}),(0,r.jsx)("button",{onClick:E,className:"px-4 py-2 bg-red-600 text-white rounded-md hover:bg-red-700",children:"Delete"})]})]})}),(0,r.jsxs)("div",{className:"flex justify-between items-center mb-8",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(i(),{href:"/plans",children:(0,r.jsx)("button",{className:"p-2 border border-gray-300 rounded-md text-gray-700 hover:bg-gray-50",children:(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M15 19l-7-7 7-7"})})})}),(0,r.jsx)("h1",{className:"text-3xl font-bold",children:l?"Create New Plan":"Edit Plan"})]}),(0,r.jsxs)("div",{className:"flex gap-2",children:[!l&&(0,r.jsxs)("button",{onClick:()=>b({show:!0}),className:"px-4 py-2 border border-gray-300 rounded-md text-red-600 hover:bg-red-50 flex items-center",children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})}),"Delete"]}),(0,r.jsx)("button",{onClick:k,disabled:u,className:"px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2 flex items-center ".concat(u?"opacity-75 cursor-not-allowed":""),children:u?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"h-4 w-4 border-2 border-white border-t-transparent rounded-full animate-spin mr-2"}),"Saving..."]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4 mr-2",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:(0,r.jsx)("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 7H5a2 2 0 00-2 2v9a2 2 0 002 2h14a2 2 0 002-2V9a2 2 0 00-2-2h-3m-1 4l-3 3m0 0l-3-3m3 3V4"})}),"Save"]})})]})]}),(0,r.jsxs)("div",{className:"grid gap-6",children:[(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg bg-white shadow-sm",children:[(0,r.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Plan Details"})}),(0,r.jsx)("div",{className:"p-6 space-y-4",children:(0,r.jsxs)("div",{className:"grid grid-cols-1 md:grid-cols-2 gap-6",children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"price",className:"block text-sm font-medium text-gray-700",children:"Price"}),(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)("span",{className:"absolute left-3 top-1/2 -translate-y-1/2 text-gray-500",children:"$"}),(0,r.jsx)("input",{id:"price",type:"number",min:"0",step:"0.01",value:y.price,onChange:e=>{let a=Number.parseFloat(e.target.value)||0;j(e=>({...e,price:a}))},className:"pl-7 w-full rounded-md border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"})]})]}),(0,r.jsxs)("div",{className:"flex items-center space-x-2 pt-8",children:[(0,r.jsx)("input",{type:"checkbox",id:"best-value",checked:y.isBestValue,onChange:e=>{j(a=>({...a,isBestValue:e.target.checked}))},className:"h-4 w-4 rounded border-gray-300 text-blue-600 focus:ring-blue-500"}),(0,r.jsx)("label",{htmlFor:"best-value",className:"text-sm font-medium text-gray-700",children:'Mark as "Best Value" plan'})]})]})})]}),(0,r.jsxs)("div",{className:"border border-gray-200 rounded-lg bg-white shadow-sm",children:[(0,r.jsx)("div",{className:"p-6 border-b border-gray-200",children:(0,r.jsx)("h2",{className:"text-xl font-semibold",children:"Plan Translations"})}),(0,r.jsxs)("div",{className:"p-6",children:[(0,r.jsx)("div",{className:"border-b border-gray-200",children:(0,r.jsx)("nav",{className:"flex -mb-px space-x-8",children:["en","fr","de","es","ar"].map(e=>(0,r.jsx)("button",{onClick:()=>m(e),className:"py-4 px-1 border-b-2 font-medium text-sm ".concat(g===e?"border-blue-500 text-blue-600":"border-transparent text-gray-500 hover:text-gray-700 hover:border-gray-300"),children:"en"===e?"English":"fr"===e?"French":"de"===e?"German":"es"===e?"Spanish":"Arabic"},e))})}),(0,r.jsx)("div",{className:"mt-4",children:y.translations.map(e=>{var a;return(0,r.jsxs)("div",{className:"space-y-4 ".concat(g===e.language?"block":"hidden"),children:[(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"duration-".concat(e.language),className:"block text-sm font-medium text-gray-700",children:"Duration"}),(0,r.jsx)("input",{id:"duration-".concat(e.language),placeholder:"en"===e.language?"e.g., Monthly":"Duration in ".concat(e.language),value:e.duration,onChange:a=>v(e.language,"duration",a.target.value),className:"w-full rounded-md border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"en"===e.language?"Required. Example: Monthly, Yearly, Lifetime, etc.":'Translation for "'.concat((null===(a=y.translations.find(e=>"en"===e.language))||void 0===a?void 0:a.duration)||"Duration",'"')})]}),(0,r.jsxs)("div",{className:"space-y-2",children:[(0,r.jsx)("label",{htmlFor:"features-".concat(e.language),className:"block text-sm font-medium text-gray-700",children:"Features"}),(0,r.jsx)("textarea",{id:"features-".concat(e.language),placeholder:"en"===e.language?"Enter features (one per line)":"Features in ".concat(e.language," (one per line)"),value:e.features.join("\n"),onChange:a=>N(e.language,a.target.value),rows:6,className:"w-full rounded-md border border-gray-300 py-2 px-3 shadow-sm focus:border-blue-500 focus:outline-none focus:ring-1 focus:ring-blue-500"}),(0,r.jsx)("p",{className:"text-sm text-gray-500",children:"en"===e.language?"Required. Enter one feature per line.":"Enter one feature per line. These should be translations of the English features."})]})]},e.language)})})]})]})]})]})}}},e=>{var a=a=>e(e.s=a);e.O(0,[173,441,517,358],()=>a(2994)),_N_E=e.O()}]);